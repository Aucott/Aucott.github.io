<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>World Clocks</title>
<style>
  :root {
    --bg: #0b1020;
    --fg: #e8ecf1;
    --muted: #93a3b3;
    --card: #141a2a;
    --card-muted: #0f1422;
    --accent: #7aa2ff;
    --danger: #ff6b6b;
    --ring: rgba(122,162,255,.35);
    --radius: 16px;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
    color: var(--fg);
    background: radial-gradient(1200px 800px at 10% -10%, #17203a 0%, var(--bg) 55%);
    min-height: 100vh;
    display: grid;
    grid-template-rows: auto 1fr;
  }
  header {
    padding: 20px clamp(16px, 4vw, 40px);
    display: grid;
    gap: 14px;
  }
  h1 {
    margin: 0;
    font-size: clamp(20px, 2.8vw, 32px);
    letter-spacing: .3px;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px 14px;
    align-items: center;
  }
  .control {
    background: var(--card);
    border: 1px solid #1e2741;
    box-shadow: var(--shadow);
    padding: 10px 12px;
    border-radius: 12px;
    display: inline-flex;
    gap: 10px;
    align-items: center;
  }
  input[type="text"] {
    outline: none;
    border: 1px solid #263055;
    background: var(--card-muted);
    color: var(--fg);
    padding: 10px 12px;
    border-radius: 10px;
    min-width: 260px;
  }
  button {
    border: 1px solid #2a3560;
    background: linear-gradient(180deg, #1a2550, #121a34);
    color: var(--fg);
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
  }
  button:hover { outline: 2px solid var(--ring); }
  .switch { display: inline-flex; align-items: center; gap: 8px; }
  .grid {
    padding: 8px clamp(16px, 4vw, 40px) 40px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
  }
  .card {
    background: linear-gradient(180deg, var(--card), #0f1426);
    border: 1px solid #1e2741;
    border-radius: var(--radius);
    padding: 14px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }
  .city {
    display: flex; justify-content: space-between; align-items: start;
    gap: 10px;
  }
  .title {
    font-weight: 600;
    font-size: 16px;
    line-height: 1.2;
  }
  .zone {
    color: var(--muted);
    font-size: 12px; margin-top: 2px;
    word-break: break-all;
  }
  .time {
    margin-top: 8px;
    font-size: clamp(26px, 4.5vw, 40px);
    font-variant-numeric: tabular-nums;
    letter-spacing: .5px;
  }
  .meta {
    margin-top: 6px;
    color: var(--muted);
    font-size: 12px;
  }
  .chip {
    background: #20305a;
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 11px;
    border: 1px solid #2a3a6b;
  }
  .remove {
    border: 1px solid #3b2231;
    background: linear-gradient(180deg, #3a1d2d, #281523);
    color: #ffd6de;
  }
  .badge {
    position: absolute; inset: 0 auto auto 0;
    translate: -30% -40%; rotate: -30deg;
    width: 200px; height: 200px; pointer-events: none;
    background: radial-gradient(closest-side, rgba(122,162,255,.08), transparent 70%);
  }
  /* night vibe */
  .night { background: linear-gradient(180deg, #0e1322, #0a0e1b); }
  .night .time { text-shadow: 0 0 14px rgba(122,162,255,.2); }
</style>
</head>
<body>
  <header>
    <h1>World Clocks</h1>
    <div class="controls">
      <div class="control">
        <input id="tzInput" type="text" list="tzList" placeholder="Add time zone (e.g., Europe/London)" />
        <datalist id="tzList"></datalist>
        <button id="addBtn">Add</button>
      </div>
      <div class="control switch">
        <input type="checkbox" id="showSeconds" />
        <label for="showSeconds">Seconds</label>
      </div>
      <div class="control switch">
        <input type="checkbox" id="use12h" />
        <label for="use12h">12-hour</label>
      </div>
      <div class="control">
        <button id="resetBtn" title="Reset to starter set">Reset</button>
      </div>
    </div>
  </header>

  <main>
    <div id="grid" class="grid" role="list"></div>
  </main>

<script>
(() => {
  // ---- Utilities ----
  const $  = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const STORAGE_KEY = "worldclocks.zones";
  const PREFS_KEY   = "worldclocks.prefs";

  const starterZones = [
    "Pacific/Auckland","Australia/Sydney","Asia/Tokyo",
    "Asia/Singapore","Asia/Dubai","Europe/London",
    "Europe/Paris","Africa/Johannesburg","America/Sao_Paulo",
    "America/New_York","America/Chicago","America/Denver","America/Los_Angeles"
  ];

  const allZones = (typeof Intl.supportedValuesOf === "function"
    ? Intl.supportedValuesOf("timeZone")
    : starterZones);

  // Build datalist (top set first, then rest)
  const tzList = $("#tzList");
  [...new Set([...starterZones, ...allZones])].forEach(z => {
    const opt = document.createElement("option");
    opt.value = z;
    tzList.appendChild(opt);
  });

  const prefs = loadPrefs();
  $("#use12h").checked = !!prefs.use12h;
  $("#showSeconds").checked = !!prefs.showSeconds;

  // ---- State ----
  let zones = loadZones();

  // ---- Rendering ----
  const grid = $("#grid");

  function zoneLabel(tz) {
    const pieces = tz.split("/");
    return (pieces[pieces.length - 1] || tz).replace(/_/g, " ");
  }

  function yyyymmddInZone(ms, tz) {
    const parts = new Intl.DateTimeFormat("en-CA", {
      timeZone: tz, year: "numeric", month: "2-digit", day: "2-digit"
    }).formatToParts(ms);
    const y = parts.find(p => p.type === "year").value;
    const m = parts.find(p => p.type === "month").value;
    const d = parts.find(p => p.type === "day").value;
    return `${y}-${m}-${d}`;
  }

  function shortOffset(tz, ms) {
    try {
      const s = new Intl.DateTimeFormat("en", {
        timeZone: tz, hour: "2-digit", timeZoneName: "shortOffset"
      }).format(ms);
      const m = s.match(/GMT[+-]\d{1,2}(?::\d{2})?/);
      return m ? m[0] : "";
    } catch { return ""; }
  }

  function hourInZone(ms, tz) {
    const parts = new Intl.DateTimeFormat("en", {
      timeZone: tz, hour: "numeric", hour12: false
    }).formatToParts(ms);
    return Number(parts.find(p => p.type === "hour")?.value ?? 0);
  }

  function dayRelation(tz, ms) {
    const localTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const localKey = yyyymmddInZone(ms, localTz);
    const tzKey    = yyyymmddInZone(ms, tz);
    if (tzKey > localKey) return "tomorrow";
    if (tzKey < localKey) return "yesterday";
    return "today";
  }

  function render() {
    grid.innerHTML = "";
    zones.forEach(tz => grid.appendChild(makeCard(tz)));
  }

  function makeCard(tz) {
    const card = document.createElement("article");
    card.className = "card";
    card.dataset.tz = tz;
    card.innerHTML = `
      <div class="badge" aria-hidden="true"></div>
      <div class="city">
        <div>
          <div class="title">${zoneLabel(tz)}</div>
          <div class="zone">${tz}</div>
        </div>
        <div>
          <button class="remove" title="Remove">Remove</button>
        </div>
      </div>
      <div class="time" aria-live="polite">--:--</div>
      <div class="meta">
        <span class="chip date">—</span>
        <span class="chip offset">—</span>
        <span class="chip rel">—</span>
      </div>
    `;
    card.querySelector(".remove").addEventListener("click", () => {
      zones = zones.filter(z => z !== tz);
      saveZones(); render();
    });
    return card;
  }

  function tick() {
    const now = Date.now();
    const use12h = $("#use12h").checked;
    const showSeconds = $("#showSeconds").checked;

    $$(".card").forEach(card => {
      const tz = card.dataset.tz;
      // Time
      const timeFmt = new Intl.DateTimeFormat([], {
        timeZone: tz,
        hour: "2-digit", minute: "2-digit",
        second: showSeconds ? "2-digit" : undefined,
        hour12: use12h
      });
      card.querySelector(".time").textContent = timeFmt.format(now);

      // Date
      const dateFmt = new Intl.DateTimeFormat([], {
        timeZone: tz,
        weekday: "short", month: "short", day: "2-digit", year: "numeric"
      });
      card.querySelector(".date").textContent = dateFmt.format(now);

      // Offset
      card.querySelector(".offset").textContent = shortOffset(tz, now);

      // Today / tomorrow / yesterday
      card.querySelector(".rel").textContent = dayRelation(tz, now);

      // Night styling (soft)
      const h = hourInZone(now, tz);
      if (h >= 20 || h < 6) card.classList.add("night");
      else card.classList.remove("night");
    });

    // save prefs occasionally
    savePrefs({ use12h, showSeconds });
  }

  // ---- Actions ----
  $("#addBtn").addEventListener("click", () => {
    const input = $("#tzInput");
    const tz = (input.value || "").trim();
    if (!tz) return;
    if (!allZones.includes(tz)) {
      alert(`"${tz}" is not a recognized IANA time zone.\nExample: Europe/London`);
      return;
    }
    if (!zones.includes(tz)) zones.push(tz);
    saveZones(); render(); input.value = ""; tick();
  });

  $("#tzInput").addEventListener("keydown", e => {
    if (e.key === "Enter") $("#addBtn").click();
  });

  $("#resetBtn").addEventListener("click", () => {
    zones = [...starterZones];
    saveZones(); render(); tick();
  });

  $("#use12h").addEventListener("change", tick);
  $("#showSeconds").addEventListener("change", tick);

  // ---- Persistence ----
  function loadZones() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      const list = raw ? JSON.parse(raw) : null;
      if (Array.isArray(list) && list.length) return list.filter(z => allZones.includes(z));
    } catch {}
    return [...starterZones];
  }
  function saveZones() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(zones));
  }
  function loadPrefs() {
    try {
      const raw = localStorage.getItem(PREFS_KEY);
      return raw ? JSON.parse(raw) : {};
    } catch { return {}; }
  }
  function savePrefs(p) {
    try { localStorage.setItem(PREFS_KEY, JSON.stringify(p)); } catch {}
  }

  // ---- Init ----
  render();
  tick();
  // Align to next exact second boundary for smooth ticking
  const drift = 1000 - (Date.now() % 1000);
  setTimeout(() => {
    tick();
    setInterval(tick, 1000);
  }, drift);
})();
</script>
</body>
</html>

